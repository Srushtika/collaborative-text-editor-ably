(function(){"use strict";var t={918:function(t,e,o){var n=o(144),a=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"app"}},[e("Container")],1)},r=[],l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"grid grid-cols-5"},[e("TextEditor",{staticClass:"col-span-3"}),e("CodeSnippet",{staticClass:"col-span-2"})],1)},s=[],i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg-white text-left p-2.5 font-ui-sans-serif mx-11",on:{mousemove:t.mouseMove}},[e("AvatarStack"),e("Cursors"),t._l(t.getTextEditorContentBlocks,(function(t){return e("TextBlock",{key:t.id,attrs:{contentBlock:t}})}))],2)},c=[],d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-5 font-sans"},[e("div",{staticClass:"flex -space-x-2 justify-end"},t._l(t.collabMembersArr,(function(o){return e("div",{key:o.clientId,staticClass:"relative inline-flex items-center justify-center w-10 h-10 ring-2 ring-white rounded-full",class:o.isConnected?t.bgColours[o.profileData.avatarColour]:"bg-gray-500"},[e("span",{staticClass:"font-medium text-white dark:text-white"},[t._v(t._s(o.profileData.initials))]),o.isConnected?e("span",{staticClass:"bottom-0 right-7 absolute w-2 h-2 bg-green-600 ring-2 ring-white dark:border-gray-800 rounded-full"}):t._e()])})),0)])},u=[],b=o(629),p={name:"AvatarStack",data(){return{collabMembersArr:[],bgColours:{red:"bg-red-400",orange:"bg-orange-400",green:"bg-green-400",amber:"bg-amber-400",lime:"bg-lime-400",cyan:"bg-cyan-400",blue:"bg-blue-400",indigo:"bg-indigo-400"}}},computed:{...(0,b.Se)(["getCollabMembers"])},watch:{getCollabMembers:function(t){this.collabMembersArr=t}}},g=p,m=o(1),h=(0,m.Z)(g,d,u,!1,null,null,null),C=h.exports,y=function(){var t=this,e=t._self._c;return e("div",[e("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",width:t.width,height:t.height,viewBox:"0 0 18 18","aria-labelledby":t.iconName,role:"presentation"}},[e("title",{attrs:{id:t.iconName,lang:"en"}},[t._v(t._s(t.iconName)+" icon")]),e("g",{attrs:{fill:t.iconColor}},[t._t("default")],2)])])},f=[],x={name:"Cursors",data(){return{iconName:"box",width:18,height:18,iconColor:"red"}}},v=x,k=(0,m.Z)(v,y,f,!1,null,null,null),T=k.exports,B=function(){var t=this,e=t._self._c;return e("div",["div"==t.contentBlock.type?e("div",{staticClass:"p-2 hover:bg-gray-100 border border-transparent",class:t.contentBlock.styling,staticStyle:{outline:"0px solid transparent"},attrs:{id:t.contentBlock.id,contenteditable:""},on:{focus:function(e){return t.setBlockLocation(e)},input:t.onInput}},[t._v(" "+t._s(t.contentBlock.content)+" "),t._l(t.contentBlock.listItems,(function(o){return t.contentBlock.listItems?e("ul",{staticClass:"list-disc pl-5"},[e("li",[t._v(t._s(o))])]):t._e()}))],2):t._e(),"hr"==t.contentBlock.type?e("hr",{staticClass:"h-px my-8 bg-gray-300 border-1 dark:bg-gray-300"}):t._e(),"checkbox"==t.contentBlock.type?e("div",{staticClass:"hover:bg-gray-100 flex items-center border border-transparent",class:t.contentBlock.styling,staticStyle:{outline:"0px solid transparent"},attrs:{id:t.contentBlock.id,contenteditable:""},on:{focus:function(e){return t.setBlockLocation(e)}}},[e("input",{staticClass:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600",staticStyle:{outline:"0px solid transparent"},attrs:{id:t.contentBlock.id+"box",type:"checkbox",value:""},domProps:{checked:t.contentBlock.isChecked}}),e("label",{staticClass:"ml-2 checkbox-1",attrs:{for:t.contentBlock.id+"box"}},[t._v(t._s(t.contentBlock.content))])]):t._e()])},_=[],w={name:"TextBlock",props:["contentBlock"],data(){return{locationUpdate:null,borderColours:{red:"border-red-400",orange:"border-orange-400",green:"border-green-400",amber:"border-amber-400",lime:"border-lime-400",cyan:"border-cyan-400",blue:"border-blue-400",indigo:"border-indigo-400"}}},computed:{...(0,b.Se)(["getLocationUpdate"])},watch:{getLocationUpdate:function(t){const e=document.getElementById(t.currentLocation.blockId),o=document.getElementById(t.previousLocation.blockId),n=t.member.profileData.avatarColour,a=this.borderColours[n];t.currentLocation.blockId!=t.previousLocation.blockId?(e&&e.classList.replace("border-transparent",a),o&&o.classList.replace(a,"border-transparent")):e.classList.replace("border-transparent",a)}},methods:{...(0,b.nv)(["setBlockLocation","setCursorLocation","updateTextContentGlobally"]),mouseMove(t){},onInput(t){if("UL"==t.srcElement.childNodes[t.srcElement.childNodes.length-1].nodeName){const e=document.getElementById(t.target.id).getElementsByTagName("li"),o=[...e].map((t=>t.innerText));this.updateTextContentGlobally({blockId:t.target.id,text:o,type:"list",caretPos:this.getCaretPos()})}else this.updateTextContentGlobally({blockId:t.target.id,text:t.target.innerText,type:"div",caretPos:this.getCaretPos()})},getCaretPos(){const t=document.getElementById(this.contentBlock.id);let e=0;const o="undefined"!==typeof window.getSelection;if(o){const o=window.getSelection();if(0!==o.rangeCount){const o=window.getSelection().getRangeAt(0),n=o.cloneRange();n.selectNodeContents(t),n.setEnd(o.endContainer,o.endOffset),e=n.toString().length}}return e}},components:{},created(){console.log("COMPONENT CREATED")},updated(){const t=document.getElementById(this.contentBlock.id);let e;t.focus();let o=this.contentBlock.caretPos;document.selection?(e=document.selection.createRange(),e.moveStart("character",o),e.select()):(e=window.getSelection(),e.collapse(t.firstChild,o))}},S=w,U=(0,m.Z)(S,B,_,!1,null,null,null),E=U.exports,P={name:"TextEditor",data(){return{locationUpdate:null,borderColours:{red:"border-red-400",orange:"border-orange-400",green:"border-green-400",amber:"border-amber-400",lime:"border-lime-400",cyan:"border-cyan-400",blue:"border-blue-400",indigo:"border-indigo-400"}}},computed:{...(0,b.Se)(["getTextEditorContentBlocks"])},watch:{},methods:{...(0,b.nv)(["setBlockLocation","setCursorLocation"]),mouseMove(t){}},components:{AvatarStack:C,Cursors:T,TextBlock:E},updated(){console.log("PARENT UPDATED")}},I=P,A=(0,m.Z)(I,i,c,!1,null,null,null),L=A.exports,M=function(){var t=this;t._self._c;return t._m(0)},O=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"bg-gray-400"},[e("p",[t._v("Placeholder for background info")])])}],Z={name:"CodeSnippet",data(){return{}}},N=Z,j=(0,m.Z)(N,M,O,!1,null,null,null),D=j.exports,R={name:"Container",data(){return{}},components:{TextEditor:L,CodeSnippet:D}},G=R,F=(0,m.Z)(G,l,s,!1,null,null,null),H=F.exports,K={name:"App",data(){return{msg:null}},created(){this.btnText="Creating your watch party...",this.isCreatingRoom=!0,this.isAdmin=!0,this.instantiateAbly({username:"Srush",isAdmin:!0})},components:{Container:H},methods:{...(0,b.nv)(["instantiateAbly"])}},W=K,$=(0,m.Z)(W,a,r,!1,null,null,null),q=$.exports,z=o(182),J=o(579);n.ZP.use(b.ZP);var Q=new b.ZP.Store({state:{ablyClient:null,spaceClient:null,myClientId:null,collabSpace:null,allAvatarColours:["red","orange","green","amber","lime","cyan","blue","indigo"],collabMembers:[],locationUpdate:{},pointer:null,textUpdatesChannel:null,textUpdate:null,textEditorContentBlocks:[{id:"header-h1",type:"div",styling:"text-4xl font-black",content:"👩🏻‍💻 Collaborative block text editor",caretPos:null},{id:"hr-1",type:"hr",styling:"h-px my-8 bg-gray-300 border-1 dark:bg-gray-300",caretPos:null},{id:"body-1",type:"div",styling:"text-lg",content:"👋 Welcome! This is a demo text editor powered by Ably's Realtime Collaboration SDK. Open another instance of this in a new tab and explore the multiplayer collaboration features.",caretPos:null},{id:"body-2",type:"div",styling:"text-lg",content:"Available features:",caretPos:null},{id:"body-3",type:"div",styling:"text-lg",content:"",listItems:["Avatar Stack","User in-app location","Live cursors","Field locking","Live app updates"],caretPos:null},{id:"hr-2",type:"hr",styling:"h-px my-8 bg-gray-300 border-1 dark:bg-gray-300",caretPos:null},{id:"header-h2-2",type:"div",styling:"text-lg pl-2",content:"TODOs",caretPos:null},{id:"chk-1",type:"checkbox",styling:"text-lg pl-2",content:"Tried the demo",isChecked:!0,caretPos:null},{id:"chk-2",type:"checkbox",styling:"text-lg pl-2",content:"Checked out the GitHub repo",isChecked:!1,caretPos:null},{id:"chk-3",type:"checkbox",styling:"text-lg pl-2",content:"Signed up to Ably",isChecked:!0,caretPos:null}]},getters:{getAblyClient:t=>t.ablyClient,getSpaceClient:t=>t.spaceClient,getMyClientId:t=>t.myClientId,getCollabSpace:t=>t.collabSpace,getCollabMembers:t=>t.collabMembers,getLocationUpdate:t=>t.locationUpdate,getTextEditorContentBlocks:t=>t.textEditorContentBlocks,getTextUpdatesChannel:t=>t.textUpdatesChannel,getTextUpdate:t=>t.textUpdate},mutations:{setAblyClient(t,e){t.ablyClient=e},setSpaceClient(t,e){t.spaceClient=e},setCollabSpace(t,e){t.collabSpace=e},setMyClientId(t,e){t.myClientId=e},setCollabMembers(t,e){t.collabMembers=e},setLocationUpdate(t,e){t.locationUpdate=e},updateTextEditorContentBlocks(t,e){const o=e.data.type;e.data.text;t.textEditorContentBlocks.forEach(((n,a,r)=>{r[a].id==e.data.blockId&&("div"==o?t.textEditorContentBlocks[a].content=e.data.text:"list"==o&&(t.textEditorContentBlocks[a].listItems=e.data.text)),t.textEditorContentBlocks[a].caretPos=e.data.caretPos}))},setTextUpdatesChannel(t,e){t.textUpdatesChannel=e},setTextUpdate(t,e){t.textUpdate=e}},actions:{instantiateAbly(t){const e=new z.Realtime({authUrl:"/auth-ably"});e.connection.once("connected",(()=>{const o=new J.Z(e),n=o.get("text-editor");t.commit("setAblyClient",e),t.commit("setSpaceClient",o),t.commit("setCollabSpace",n),t.commit("setMyClientId",e.auth.clientId),t.state.collabSpace.enter({username:t.state.myClientId,initials:t.state.myClientId.slice(-2).toUpperCase(),avatarColour:t.state.allAvatarColours[Math.floor(Math.random()*t.state.allAvatarColours.length)]}),t.dispatch("subscribeToMembers"),t.dispatch("subscribeToTextUpdateChannel"),t.dispatch("subscribeToLocations"),t.dispatch("subscribeToCursors")}))},subscribeToMembers(t){t.state.collabSpace.on("membersUpdate",(e=>{t.commit("setCollabMembers",e),console.log("Total user count",t.state.collabMembers.length,"Members:",t.state.collabMembers[0].location)}))},subscribeToTextUpdateChannel(t){const e=t.state.ablyClient.channels.get("text-updates");t.commit("setTextUpdatesChannel",e),e.subscribe((e=>{t.commit("updateTextEditorContentBlocks",e)}))},subscribeToLocations(t){t.state.collabSpace.locations.on("locationUpdate",(e=>{t.commit("setLocationUpdate",e)}))},setBlockLocation(t,e){t.state.collabSpace.locations.set({blockId:e.target.id})},subscribeToCursors(t){t.state.pointer=t.state.collabSpace.cursors.get("pointer"),t.state.collabSpace.cursors.on("cursorsUpdate",(t=>{console.log(t)}))},setCursorLocation(t,e,o){t.state.pointer.set({position:{x:e,y:o},data:{color:"red"}})},updateTextContentGlobally(t,e){t.state.textUpdatesChannel.publish("newText",e)}}});n.ZP.config.productionTip=!1,new n.ZP({store:Q,render:t=>t(q)}).$mount("#app")}},e={};function o(n){var a=e[n];if(void 0!==a)return a.exports;var r=e[n]={exports:{}};return t[n](r,r.exports,o),r.exports}o.m=t,function(){var t=[];o.O=function(e,n,a,r){if(!n){var l=1/0;for(d=0;d<t.length;d++){n=t[d][0],a=t[d][1],r=t[d][2];for(var s=!0,i=0;i<n.length;i++)(!1&r||l>=r)&&Object.keys(o.O).every((function(t){return o.O[t](n[i])}))?n.splice(i--,1):(s=!1,r<l&&(l=r));if(s){t.splice(d--,1);var c=a();void 0!==c&&(e=c)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[n,a,r]}}(),function(){o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})}}(),function(){o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){var t={143:0};o.O.j=function(e){return 0===t[e]};var e=function(e,n){var a,r,l=n[0],s=n[1],i=n[2],c=0;if(l.some((function(e){return 0!==t[e]}))){for(a in s)o.o(s,a)&&(o.m[a]=s[a]);if(i)var d=i(o)}for(e&&e(n);c<l.length;c++)r=l[c],o.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return o.O(d)},n=self["webpackChunkapp_collaborative_text_editor_vue"]=self["webpackChunkapp_collaborative_text_editor_vue"]||[];n.forEach(e.bind(null,0)),n.push=e.bind(null,n.push.bind(n))}();var n=o.O(void 0,[998],(function(){return o(918)}));n=o.O(n)})();
//# sourceMappingURL=app.af72e7b5.js.map